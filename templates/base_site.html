<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}åŒ»ç–—æ•°æ®å¹³å°{% endblock %}</title>
    
    <link href="/static/vendors/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <link href="/static/vendors/nprogress/nprogress.css" rel="stylesheet">
    <link href="/static/build/css/custom.min.css" rel="stylesheet">
    
    <style>
        /* =========================================
           1. å¸ƒå±€æ ¸å¿ƒä¿®å¤ (è§£å†³é«˜åº¦ä¸èƒŒæ™¯æ–­å±‚)
           ========================================= */
        .nav-md .container.body .col-md-3.left_col {
            min-height: 100%;
        }
        
        /* è®©å³ä¾§å†…å®¹åŒºæ’‘æ»¡å±å¹•ï¼Œå¹¶ä½¿ç”¨æŸ”å’Œçš„ç°è‰²èƒŒæ™¯ */
        .right_col {
            min-height: 100vh !important;
            background-color: #F7F7F7 !important;
        }

        .main_container {
            background-color: #2A3F54;
        }

        /* =========================================
           2. ä¸‹æ‹‰èœå•ç»ˆæä¿®å¤ (è§£å†³ç‚¹å‡»ä¸æ˜¾ç¤º/ä½ç½®é”™ä¹±)
           ========================================= */
        
        /* å…è®¸é¡¶éƒ¨å¯¼èˆªæº¢å‡ºï¼Œé˜²æ­¢èœå•è¢«è£å‰ª */
        .top_nav .nav_menu {
            overflow: visible !important;
        }
        
        /* ç»™çˆ¶çº§ li å»ºç«‹å®šä½åŸºå‡†ï¼Œé˜²æ­¢èœå•è·‘åˆ°é¡µé¢(0,0)åæ ‡ */
        .navbar-nav > li {
            position: relative !important;
        }
    
        /* ä¸‹æ‹‰èœå•æ ·å¼é‡ç½® */
        .navbar-right .dropdown-menu {
            position: absolute !important;
            top: 100% !important; /* åœ¨å¤´åƒæ­£ä¸‹æ–¹ */
            right: 0 !important;
            left: auto !important;
            z-index: 99999 !important; /* ä¿è¯æœ€é¡¶å±‚ */
            margin-top: 2px;
            background-color: #fff;
            border: 1px solid #d9d9d9;
            box-shadow: 0 6px 12px rgba(0,0,0,.175);
            display: none; /* é»˜è®¤éšè— */
        }
        
        /* ğŸ”¥ å…³é”®ï¼šå½“ JS æ·»åŠ  open ç±»æ—¶ï¼Œå¼ºåˆ¶æ˜¾ç¤ºèœå• */
        .navbar-nav > li.open .dropdown-menu {
            display: block !important;
        }
    
        /* å¤´åƒç‚¹å‡»åŒºåŸŸå±‚çº§ */
        .user-profile {
            position: relative !important;
            z-index: 9999 !important;
            cursor: pointer;
        }
        
        /* =========================================
           3. ç•Œé¢ç¾åŒ– (å¡ç‰‡åœ†è§’ä¸é˜´å½±)
           ========================================= */
        .x_panel {
            border: none !important;
            border-radius: 8px !important;
            background-color: #fff !important;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05) !important; /* æ‚¬æµ®é˜´å½± */
            margin-bottom: 20px;
            padding: 20px !important;
        }

        .x_title {
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        /* åº•éƒ¨ Footer ç¾åŒ– */
        footer {
            background: #F7F7F7 !important;
            color: #999;
            padding: 15px 20px;
            border-top: 1px solid #e7e7e7;
        }
    </style>
    {% block css %}{% endblock %}
</head>

<body class="nav-md">
    <div class="container body">
        <div class="main_container">
            <div class="col-md-3 left_col">
                <div class="left_col scroll-view">
                    <div class="navbar nav_title" style="border: 0;">
                        <a href="/" class="site_title"><i class="fa fa-heartbeat"></i> <span>YinTu åŒ»ç–—</span></a>
                    </div>
                    <div class="clearfix"></div>
                    <br />
                    
                    <div id="sidebar-menu" class="main_menu_side hidden-print main_menu">
                        
                        {% if user.is_superuser %}
                        <div class="menu_section">
                            <h3>ç®¡ç†å‘˜åå°</h3>
                            <ul class="nav side-menu">
                                <li><a href="{% url 'hospital:index' %}"><i class="fa fa-h-square"></i> åŒ»é™¢ç«¯åˆ—è¡¨ (A)</a></li>
                                <li><a href="{% url 'labeler:dashboard' %}"><i class="fa fa-pencil-square-o"></i> æ ‡æ³¨ç«¯çœ‹æ¿ (B)</a></li>
                                <li><a href="/admin/"><i class="fa fa-cogs"></i> ç³»ç»Ÿç®¡ç†</a></li>
                            </ul>
                        </div>
                        {% endif %}

                        {% if user.role == 'hospital' or user.is_superuser %}
                        <div class="menu_section">
                            <h3>Aç«¯ / åŒ»é™¢</h3>
                            <ul class="nav side-menu">
                                <li><a href="{% url 'hospital:add' %}"><i class="fa fa-plus-circle"></i> æ–°å»ºç—…ä¾‹ä»»åŠ¡</a></li>
                                <li><a href="{% url 'hospital:index' %}"><i class="fa fa-list-ul"></i> ä»»åŠ¡çŠ¶æ€åˆ—è¡¨</a></li>
                            </ul>
                        </div>
                        {% endif %}

                        {% if user.role == 'labeler' or user.is_superuser %}
                        <div class="menu_section">
                            <h3>Bç«¯ / æ ‡æ³¨</h3>
                            <ul class="nav side-menu">
                                <li><a href="{% url 'labeler:dashboard' %}"><i class="fa fa-folder-open"></i> ä»»åŠ¡é¢†å–å¤§å…</a></li>
                            </ul>
                        </div>
                        {% endif %}
                        
                    </div>
                </div>
            </div>

            <div class="top_nav">
                <div class="nav_menu">
                    <nav>
                        <div class="nav toggle">
                            <a id="menu_toggle"><i class="fa fa-bars"></i></a>
                        </div>

                        <ul class="nav navbar-nav navbar-right">
                            <li class="">
                                <a href="javascript:;" class="user-profile dropdown-toggle" aria-expanded="false">
                                    <img src="/static/images/user.png" alt="">
                                    {% if user.is_authenticated %}
                                        {{ user.username }}
                                        <span class=" fa fa-angle-down"></span>
                                    {% else %}
                                        æœªç™»å½•
                                    {% endif %}
                                </a>
                                
                                <ul class="dropdown-menu dropdown-usermenu pull-right">
                                    <li>
                                        <a href="javascript:;">
                                            <span><i class="fa fa-question-circle pull-right"></i> å¸®åŠ©æ–‡æ¡£</span>
                                        </a>
                                    </li>
                                    <li class="divider"></li>
                                    <li>
                                        <a href="{% url 'users:logout' %}">
                                            <i class="fa fa-sign-out pull-right"></i> 
                                            <strong>ğŸ”„ åˆ‡æ¢è´¦å· / é€€å‡º</strong>
                                        </a>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>

            {% block content %}{% endblock %}

            <footer>
                <div class="pull-right">YinTu System v1.0</div>
                <div class="clearfix"></div>
            </footer>
        </div>
    </div>

    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    
    <script src="https://cdn.bootcdn.net/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/nprogress/0.2.0/nprogress.min.js"></script>
    
    <script src="/static/build/js/custom.min.js"></script>
    
    {% block js %}{% endblock %}

    <script>
    $(document).ready(function() {
        // 1. ç‚¹å‡»å¤´åƒï¼šåˆ‡æ¢ 'open' ç±»
        $('.user-profile').on('click', function(e) {
            // é˜»æ­¢å†’æ³¡ï¼Œé˜²æ­¢è¢«å…¶ä»–è„šæœ¬æ‹¦æˆª
            e.stopPropagation();
            e.preventDefault();
            
            var $parent = $(this).parent(); // è·å– li
            
            // åˆ‡æ¢ open ç±» (CSS ä¸­å®šä¹‰äº† .open .dropdown-menu { display: block })
            if ($parent.hasClass('open')) {
                $parent.removeClass('open');
            } else {
                // å…ˆå…³é—­å…¶ä»–èœå•
                $('.navbar-nav > li').removeClass('open');
                $parent.addClass('open');
            }
        });

        // 2. ç‚¹å‡»é¡µé¢ç©ºç™½å¤„ï¼šå…³é—­èœå•
        $(document).on('click', function() {
            $('.navbar-nav > li').removeClass('open');
        });
        
        // 3. é˜»æ­¢èœå•å†…éƒ¨ç‚¹å‡»å…³é—­ (é˜²æ­¢è¯¯æ“ä½œ)
        $('.dropdown-menu').on('click', function(e){
            e.stopPropagation();
        });
    });
    </script>
</body>
</html>