{% extends "common/base.html" %}

{% block content %}
<style>
    .medical-card {
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 5px 25px rgba(0,0,0,0.05);
        border-top: 5px solid #27ae60;
        padding: 40px 50px;
        margin-top: 20px;
    }
    .upload-zone-wrapper {
        position: relative;
        width: 100%;
        height: 180px;
        background: #f9fbfc;
        border: 2px dashed #bdc3c7;
        border-radius: 8px;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
    }
    .upload-zone-wrapper:hover { border-color: #27ae60; background: #f0fff4; }
    .upload-zone-wrapper input[type="file"] {
        position: absolute; width: 100%; height: 100%; opacity: 0; cursor: pointer;
    }
    .upload-text { text-align: center; color: #7f8c8d; }
    .upload-text i { font-size: 40px; margin-bottom: 10px; display: block; }
    .file-name { color: #27ae60; font-weight: bold; display: none; margin-top: 10px;}
</style>

<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="medical-card">
                <h3 class="mb-4"><i class="fa fa-plus-circle"></i> 新建病例任务</h3>
                
                <form method="post" enctype="multipart/form-data" id="upload-form">
                    {% csrf_token %}
                    
                    <div class="mb-3">
                        <label class="form-label">任务名称 <span class="text-danger">*</span></label>
                        <input type="text" name="name" class="form-control" required placeholder="例如：张三_心脏造影">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">病情备注</label>
                        <textarea name="remark" class="form-control" rows="2"></textarea>
                    </div>

                    <div class="row mb-4">
                        <div class="col-md-6">
                            <label class="form-label text-danger"><i class="fa fa-lock"></i> 病例文件 (加密)</label>
                            <div class="upload-zone-wrapper">
                                <input type="file" name="patient_file" onchange="showFile(this)">
                                <div class="upload-text">
                                    <i class="fa fa-file-text"></i>
                                    <span>点击上传病例</span>
                                    <div class="file-name"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label text-primary"><i class="fa fa-film"></i> 视频源 (抽帧)</label>
                            <div class="upload-zone-wrapper">
                                <input type="file" name="video_file" required onchange="showFile(this)">
                                <div class="upload-text">
                                    <i class="fa fa-video-camera"></i>
                                    <span>点击上传视频</span>
                                    <div class="file-name"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="text-end">
                        <a href="{% url 'hospital:index' %}" class="btn btn-light">取消</a>
                        <button type="submit" class="btn btn-success px-5" id="submit-btn">提交任务</button>
                    </div>
                </form>
                
                <!-- 简单的加载提示 -->
                <div id="loading" style="display:none; text-align:center; margin-top:20px;">
                    <p class="text-success"><i class="fa fa-spinner fa-spin"></i> 正在加密并处理视频，请稍候...</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function showFile(input) {
    if(input.files && input.files[0]) {
        let name = input.files[0].name;
        let wrapper = input.parentElement;
        wrapper.querySelector('span').style.display = 'none';
        wrapper.querySelector('.file-name').textContent = name;
        wrapper.querySelector('.file-name').style.display = 'block';
        wrapper.style.borderColor = '#27ae60';
        wrapper.style.background = '#f0fff4';
    }
}
document.getElementById('upload-form').onsubmit = function() {
    document.getElementById('submit-btn').disabled = true;
    document.getElementById('loading').style.display = 'block';
}
</script>
{% endblock %}